<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Managing dependencies for your C++ projects is always cumbersome, or is it ?"><title>vcpkg - a c++ package manager
</title><link rel="shortcut icon" type=image/x-icon href=/><link rel=stylesheet href=/css/main.51652302d3a998bf7887aed5c2cf89141bbebdf45a2c8f87b0717a3cf4f51c4e53c694c328fb1de78c3a625a1c01f80745bf1f2f42c040647a245cbbb6c2d1d7.css integrity="sha512-UWUjAtOpmL94h67Vws+JFBu+vfRaLI+HsHF6PPT1HE5TxpTDKPsd54w6YlocAfgHRb8fL0LAQGR6JFy7tsLR1w=="></head><body a=auto><main class=page-content aria-label=Content><div class=w><div class=post-meta><a href=/>..</a><p><time datetime="2024-03-30 00:53:07 +0530 +0530">2024-03-30</time></p></div><article><h1>vcpkg - a c++ package manager</h1><h1 id=introduction>Introduction</h1><p>Do you use C++?</p><p>Do you struggle with maintaining dependencies for your projects?</p><p>Is it taking too much time to setup your C++ development environment setup ?</p><p>If <strong>YES</strong>, then consider that your development workflow is going to become smooth after reading this post.</p><p>One of the things where we bang our heads when dealing with C++ is managing third party dependencies that we use in our projects.
Be it a seasoned user or a novice, everyone must have tackled this issue somewhere at sometime using different ways.</p><p><img src=assets/struggle.png alt=struggle title=struggle></p><p>But is there a thing as which one&rsquo;s the &ldquo;best&rdquo; way ?</p><p>Ofcourse, there isn&rsquo;t, but anything that makes me not bang my head against the table, I would consider it a better way.
And this is where we&rsquo;ll be talking about Package Managers, and specifically about <code>vcpkg</code>.</p><h1 id=vcpkg>vcpkg</h1><p><a href=https://vcpkg.io/en/>vcpkg</a> is a package or dependency manager for C++. It&rsquo;s very unfortunate that there is no official package manager for C++ at it&rsquo;s dawn. I am not sure if the concept of &ldquo;package managers&rdquo; even existed</p><h2 id=installation>Installation</h2><p>It&rsquo;s pretty easily actually.</p><p>We&rsquo;ll be focusing on GNU/Linux installation entirely. This applies for usage as well. I&rsquo;ll be using Debian 12.
But 90% of the times, it&rsquo;s pretty much the same in Microsoft Windows.</p><p>Clone the repo.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>git clone https://github.com/microsoft/vcpkg.git
</span></span></code></pre></div><p>Run the script</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cd vcpkg <span style=color:#f92672>&amp;&amp;</span> ./bootstrap-vcpkg.sh
</span></span></code></pre></div><p>You can add <code>-disableMetrics</code> as an arugment to the shell script, if you don&rsquo;t want Microsoft to spy on you.</p><p>Then if you want to run <code>vcpkg</code> from anywhere in your shell, you can add the PATH to your <code>.bashrc</code> or profile file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>export VCPKG_ROOT<span style=color:#f92672>=</span>/path/to/vcpkg
</span></span><span style=display:flex><span>export PATH<span style=color:#f92672>=</span>$VCPKG_ROOT:$PATH
</span></span></code></pre></div><p>After this, you can probably run <code>vcpkg</code> from any directory.</p><h2 id=usage>Usage</h2><p>Now to come to the part where we actually use <code>vcpkg</code> in our C++ project. I&rsquo;ll use a demo project.</p><h3 id=demo-project>Demo Project</h3><p>We will be using <a href=https://github.com/fmtlib/fmt><code>fmt</code></a> library to print something.</p><p><code>main.cxx</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#75715e>#include</span> <span style=color:#75715e>&lt;fmt/core.h&gt;</span><span style=color:#75715e>
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>  fmt<span style=color:#f92672>::</span>print(<span style=color:#e6db74>&#34;Mitochondria is the powerhouse of the cell!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>  
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And to build this project, we&rsquo;ll be using CMake.</p><p>So, our initial project directory would look like this.</p><pre tabindex=0><code>demo/
├── CMakeLists.txt
└── main.cxx
</code></pre><p>Now from our <code>demo</code> directory, do</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vcpkg new --application
</span></span></code></pre></div><p>This would create two new files in our <code>demo</code> directory.</p><ul><li><code>vcpkg.json</code> - The file where we define our dependencies.</li><li><code>vcpkg-configuration.json</code> - the file where we define how <code>vcpkg</code> behaves, such as which custom registry to use etc.</li></ul><p>The above way of initialising & using <code>vcpkg</code> is called as <strong>Manifest Mode</strong>.</p><p>There are 2 modes generally.</p><ul><li>Classic</li><li>Manifest</li></ul><p>We&rsquo;ll be using Manifest mode throughout this post, because it is BETTER!</p><p>Now, to add a dependency to our project, which is <code>fmt</code>,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>vcpkg add port fmt
</span></span></code></pre></div><p>You can search for many packages at <a href=https://vcpkg.io/en/packages>https://vcpkg.io/en/packages</a>.</p><p>Now, if you open that <code>vcpkg.json</code> file, you can see that the dependency we added is present.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;dependencies&#34;</span>: [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>  ]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=cmakeliststxt>CMakeLists.txt</h3><p>Make sure you have <code>cmake</code> installed beforehand along with something like <code>make</code> or <code>ninja</code>. Since this is a small demo project, we can have the following in our demo project.</p><p><code>CMakeLists.txt</code></p><pre tabindex=0><code>cmake_minimum_required(VERSION 3.12)

project(&#34;demo&#34;)

find_package(fmt CONFIG REQUIRED)

add_executable(demo &#34;main.cxx&#34;)
</code></pre><p>Now, obviously, when you run this,</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cmake -S . -B build
</span></span></code></pre></div><p>you&rsquo;ll be getting an error.</p><p>Now to use vcpkg with CMake, we need the CMake to use the vcpkg CMake toolchain file (<code>vcpkg.cmake</code>) when we configure our CMake against our <code>CMakeLists.txt</code> file.</p><p>We can do this by specifying the path to the toolchain file using <code>CMAKE_TOOLCHAIN_FILE</code> to pass the path to the <code>vcpkg.cmake</code> file.
This can be done in many ways. But for now, we will use this as an argument with CMake command.</p><p>Delete the existing <code>build</code> directory.
Then, do</p><pre tabindex=0><code>cmake -S . -B build -DCMAKE_TOOLCHAIN_FILE=$VCPKG_ROOT/scripts/buildsystems/vcpkg.cmake
</code></pre><p>Now this would actually use <code>vcpkg</code> to build the dependencies specified, and at the end it also shows how to utilise the dependency in your <code>CMakeLists.txt</code> file.</p><pre tabindex=0><code>The package fmt provides CMake targets:

    find_package(fmt CONFIG REQUIRED)
    target_link_libraries(main PRIVATE fmt::fmt)

    # Or use the header-only version
    find_package(fmt CONFIG REQUIRED)
    target_link_libraries(main PRIVATE fmt::fmt-header-only)
</code></pre><p>After this configuration, we can try building.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>cmake --build build
</span></span></code></pre></div><p>This above command would probably output the following.</p><pre tabindex=0><code>-- Running vcpkg install
Detecting compiler hash for triplet x64-linux...
Compiler found: /usr/bin/c++
All requested packages are currently installed.
Total install time: 1.12 us
The package fmt provides CMake targets:

    find_package(fmt CONFIG REQUIRED)
    target_link_libraries(main PRIVATE fmt::fmt)

    # Or use the header-only version
    find_package(fmt CONFIG REQUIRED)
    target_link_libraries(main PRIVATE fmt::fmt-header-only)

-- Running vcpkg install - done
-- Configuring done
-- Generating done
-- Build files have been written to: /home/mito/demo/build
[ 50%] Building CXX object CMakeFiles/demo.dir/main.cxx.o
[100%] Linking CXX executable demo
[100%] Built target demo
</code></pre><p>Looks like the binary <code>demo</code> was built.
Let&rsquo;s try running it.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>./build/demo
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Mitochondria is the powerhouse of the cell!
</span></span></code></pre></div><p>It works!</p><p>Now this is far better than manually downloading the source code of the library, building it, using the header files in your src, etc..</p></article></div></main></body></html>